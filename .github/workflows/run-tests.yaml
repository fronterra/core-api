# GitHub Actions YAML file adapted from actions/example-services repo, ./mongodb directory
# See for more info: https://github.com/actions/example-services/tree/7ae0b005cc273e2000e12ccf54f01e796c22b3e4

name: Mongodb Service Example

on:
  push:
    branches:
    - main
  pull_request:
    branches:
    - main

jobs:
  container-job:
    runs-on: ubuntu-latest

    # runs all of the steps inside the specified container rather than on the VM host.
    # Because of this the network configuration changes from host based network to a container network.
    container:
      image:  node:10.16-jessie

    services:
      mongodb:
        image: mongo
        ports:
        - 27017:27017

    steps:
      - uses: actions/checkout@v1
      - run: npm ci
        env:
          # use localhost for the host here because we are running the job on the VM.
          # If we were running the job on in a container this would be mongodb
          TEST_DB_NAME: test-database
          TEST_DB_URI: mongodb://127.0.0.1:27017
          TEST_COLLECTION_NAME: test-collection          
      - run: npm test